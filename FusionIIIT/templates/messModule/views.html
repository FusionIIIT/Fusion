
{% load static %}
{#{% block body %}#}
{% block views %}

    {% comment %}The tab menu starts here!{% endcomment %}
    <div class="ui pointing secondary menu">
        <a class="active item" id="menu1">
            Menu 
        </a>

        <a class="item" id="billm">
            Bill
        </a>
<!--
        <a class="item" id="ph">
            Payment History
        </a>
        -->
        <a class="item" id="regm">
            Register for Mess
        </a>
    </div>

    <div class="ui active tab  " id="menu1tab">
        <div class="ui vertical segment {% if messinfo.mess_option == 'no-mess' %}disabled {% endif %}">
            <table class="ui definition table" style="padding: 8px; padding-left: 8px; padding-right: 8px;">
                <thead>
                <tr>
                    <th></th>
                    <th style="cursor:pointer;">Breakfast </th>
                    <th style="cursor:pointer;">Lunch</th>
                    <th style="cursor:pointer;">Dinner</th> 
                </tr>
                </thead>

                <tbody>

                <tr>
                    
                    <td>Monday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'MB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'ML' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'MD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                </tr>

                <tr>
                    
                    <td>Tuesday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'TB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'TL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'TD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}


                </tr>

                <tr>
                    
                    <td>Wednesday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'WB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'WL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'WD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </tr>

                <tr>
                    
                    <td>Thursday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'THB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'THL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'THD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}
                </tr>

                <tr>
                    

                    <td>Friday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'FB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'FL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'FD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                </tr>

                <tr>
                    <td>Saturday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                </tr>

                <tr>
                    
                    <td>Sunday</td>

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SUB' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SUL' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                    {% for item in reg_menu %}
                        {% if item.mess_option == messinfo.mess_option %}
                            {% if item.meal_time == 'SUD' %}
                                <td>{{item.dish}}</td>
                            {% endif %}
                        {% endif %}
                    {% endfor %}

                </tr>
                    
                
                </tbody>

            </table>

            <br>
            <div class="ui divider"></div>
            <div class="extra content">
                <!-- TODO add code to direct to a function which renders the template as a pdf file -->
                <form method="post" target="_blank" action="{% url 'mess:MenuPDF' %}">
                    {% csrf_token %}
                <button type="submit" class="ui primary button right floated">
                    <!-- Download -->
                    <i class="ui download icon right floated"></i>
                </button>
                </form>
                <br>
            </div>

        </div>
    </div>

    <div class="ui tab" id="billmtab">
        <div class="ui vertical segment">

            <table class="ui very basic collapsing celled table sortable centered" style="margin: auto;">
                <thead>
                <tr>
                    <th>Month</th>
                    <th>Monthly bill</th>
                    <th>Rebate Count</th>
                    <th>Rebate Amt</th>
                    <th>Total</th>
                    <th>Paid</th>
                    <th>Due Amount</th>
                </tr></thead>
                <tbody>
                {% for stu in monthly_bill %}
                <tr>
                    <td>{{stu.month}} - {{ stu.year }}</td>
                    <td>{{stu.amount}}</td>
                    <td>{{stu.rebate_count}}</td>
                    <td>{{stu.rebate_amount}}</td>
                    <td>{{stu.total_bill}}</td>
                    <td>
                        {% if stu.paid %}
                            <i class="large green checkmark icon"></i>
                        {% else %}
                         <i class="large red x icon"></i>
                        {% endif %}
                    </td>
                     <td>
                        {% if stu.paid %}
                            0
                        {% else  %}
                            {{stu.due_amount}}
                        {% endif %}
                    </td>

                </tr>
                {% endfor %}
                </tbody>
            </table>
            <h2>Total Due Amount : {{total_due}}</h2>
            <br>
            <br>

            <div class="ui divider"></div>

        </div>
    </div>

    <div class="ui tab" id="phtab">
        <table class="ui very basic collapsing celled table sortable" style="margin: auto;">
            <thead>
                <tr>
                    <th>Student</th>
                    <th>Sem</th>
                    <th>Amount</th>
                    <th>Status</th>
                </tr>
            </thead>

        </table>

        <br>

        <div class="ui divider"></div>

    </div>

    <div class="ui tab" id="regmtab">
    <div class="ui vertical segment">

        {% comment %}Form Tag starts here!{% endcomment %}
        <form method="post" action="{% url 'mess:regsubmit' %}">
            {% csrf_token %}
            <div class="ui form" style="padding: 8px; padding-left: 24px; padding-right: 24px;">

                <div class="ui header">
                    Request for change of Central Mess:
                </div>
                {{current_date}}
                <br>

                <div class="two fields">
                    <div class="field">
                        <strong> Currently registered in {{ messinfo.mess_option | capfirst }}</strong>
                        <br>
                        <input type="date" id="date" name="date" value="{{mess_reg.end_reg}}" hidden>
                        <br>
                        {% if current_date <= mess_reg.end_reg %}
                            <label>Choose Mess*</label>
                            <select class="ui search fluid dropdown" name="mess_type" id="mess_type">
                                <option value="mess1">Mess 1</option>
                                <option value="mess2">Mess 2</option>
                            </select>
                            <div class="field">
                                <button class="ui primary button right floated" type="submit" name="submit">
                                Submit
                                </button>
                            </div>
                        {% else %}
                            Registration time period has ended.
                        {% endif %}
                    </div>
                </div>
    </form>    


        </div>
    </form>
    {% comment %}Form Tag ends here!{% endcomment %}
        <br>
        <br>
        <div class="ui divider"></div>

    </div>
</div>

{% endblock %}
{#{% endblock %}#}

{% block javascript %}
<script>
  $(document).ready(function() {
        $('#menu1').on('click', function () {
            $(this).addClass('active');
            $('#ph').removeClass('active');
            $('#regm').removeClass('active');
               $('#billm').removeClass('active');
             $('#menu1tab').show();
               $('#billmtab').hide();
                 $('#regmtab').hide();
                   $('#phtab').hide();


        });
    });
    $(document).ready(function() {
        $('#ph').on('click', function () {
            $(this).addClass('active');
            $('#menu1').removeClass('active');
            $('#billm').removeClass('active');
               $('#regm').removeClass('active');
             $('#phtab').show();
               $('#menu1tab').hide();
                 $('#regmtab').hide();
                   $('#billmtab').hide();


        });
    });
      $(document).ready(function() {
        $('#billm').on('click', function () {
            $(this).addClass('active');
            $('#regm').removeClass('active');
            $('#ph').removeClass('active');
               $('#menu1').removeClass('active');
             $('#billmtab').show();
               $('#regmtab').hide();
                 $('#menu1tab').hide();
                   $('#phtab').hide();


        });
    });
        $(document).ready(function() {
        $('#regm').on('click', function () {
            $(this).addClass('active');
            $('#billm').removeClass('active');
            $('#ph').removeClass('active');
               $('#menu1').removeClass('active');
             $('#regmtab').show();
               $('#billmtab').hide();
                 $('#menu1tab').hide();
                   $('#phtab').hide();


        });
    });
</script>

 <script>
  function download(){
            $.ajax({
                type: 'POST',
                url: 'menudownload/',
                dataType: 'json',

                success: function(data) {

                },
                error: function(data, err) {

                }
            });
        return false;
    }

</script>
{% endblock %}