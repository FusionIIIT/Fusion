{% load static %}
{% block body %}
{% block respondtoleave %}

<div class="ui pointing secondary menu">
    <a class="active item" data-tab="respondtoleaverequests">
        Respond to Leave Requests
    </a>

    <a class="item" data-tab="leavepastrecords" onclick="getLeave()">
        Past Records
    </a>

</div>


<div class="ui active tab" data-tab="respondtoleaverequests">
    <div class="ui vertical segment">
        <table class="ui very basic collapsing celled large sortable table"
               style="padding-left: 2.5%;
                                                          padding-right: 2.5%;
                                                          padding-top: 1%;
                                                          padding-bottom: 1.5%;
                                                          margin: auto;">
            <thead>
            <tr>
                <th class="four wide">
                    Date
                </th>

                <th class="four wide">
                    Student
                </th>

                <th class="four wide">
                    Type
                </th>

                <th class="two wide">
                    Purpose
                </th>

                <th class="two wide">
                    From
                </th>

                <th class="two wide">
                    To
                </th>
                <th class="one wide">
                    Approve
                </th>
            </tr>
            </thead>

            <tbody>
            {% for item in leave %}
            <tr id="accr-{{item.pk}}">
                <th>
                    {{item.app_date}}
                </th>
                <td>
                    <h4 class="ui image header">
                        <img src="{% static 'globals/img/zlatan.jpg' %}" class="ui mini circular image">
                        <div class="content">
                            {{item.student_id.id}}
                            <!-- <div class="sub header">
                                2015121
                            </div> -->
                        </div>
                    </h4>
                </td>

                <td>
                    {{item.leave_type}}
                </td>

                <td>
                    {{item.purpose}}
                </td>

                <td>
                    {{item.start_date}}
                </td>

                <td>
                    {{item.end_date}}
                </td>

                <td>
                    <div class="ui buttons">
                        <button class="acc ui positive button" name="submit" value="approve" data-acc="{{item.pk}}"
                                onclick="acceptReq({{item.pk}})">A
                        </button>

                        <div class="or"></div>
                        <button class="ui negative button" name="submit" value="reject"
                                onclick="rejectReq({{item.pk}})">R
                        </button>

                    </div>

                    <!--
                    <form action="{{item.pk}}/rebateresponse/" method="POST" >
                    {% csrf_token %}
                    <div class="ui buttons">
                        <button class="ui negative button" name="submit" value="reject" >R</button>
                        <div class="or"></div>
                        <button class="ui positive button" name="submit" value="approve" >A</button>
                    </div>
                    </form>
                    -->
                </td>
            </tr>
            {% endfor %}
        </table>

        <br>

        <div class="ui divider"></div>

    </div>
</div>
<!-- end leave request-->

<!--leav request past records-->
<div class ="ui tab" data-tab="leavepastrecords" id="pastmessleave">
    <div class="ui vertical segment">
        <!--<div class="ui pointing tertiary menu>">-->
            <!--<a class="active item" id="acceptedleave" data-tab="acceptedleave" onclick="getAcceptedLeave()">Accepted Requests</a>-->

            <!--<a class="item" id="rejectedleave" data-tab="rejectedleave">Rejected Requests</a>-->
        <!--</div>-->
        <table id="leaverecords" class="ui very basic collapsing celled large sortable table"
               style="padding-left: 2.5%;
                                                          padding-right: 2.5%;
                                                          padding-top: 1%;
                                                          padding-bottom: 1.5%;
                                                          margin: auto;">
            <thead>
            <tr>
                <th class="four wide">
                    Student
                </th>

                <th class="four wide">
                    Type
                </th>

                <th class="two wide">
                    From
                </th>

                <th class="two wide">
                    To
                </th>
                <th class="one wide">
                    Status
                </th>
            </tr>
            </thead>

            <tbody>
            {% for item in leave %}
                {% if item.status == '2' %}
                <tr>
                <th class="four wide">
                    {{item.student_id.id}}
                </th>

                <th class="four wide">
                    {{item.leave_type}}
                </th>

                <th class="two wide">
                    {{item.start_date}}
                </th>

                <th class="two wide">
                    {{item.end_date}}
                </th>
                <th class="one wide">
                    Accepted
                </th>
            </tr>
                {% endif %}
            {% endfor %}
            </tbody>

        </table>

        <br>

        <div class="ui divider"></div>

    </div>
</div>
{% endblock %}
{% endblock %}

{% block javascript %}
<script>

function acceptReq(id){

         document.getElementById('accr-'+id).style.visibility='hidden';
         $.ajax({
                type: 'POST',
                url: 'rebateresponse',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken' : '{{ csrf_token }}',
                    'id_rebate':$("button.acc").attr("data-acc"),
                    'status':'2',

                },
                success: function(data) {

                        alert(data.message);


                },
                error: function(data, err) {
                    alert(err.message);
                }
            });

         }
         function rejectReq(id){

         document.getElementById('accr-'+id).style.visibility='hidden';
         $.ajax({
                type: 'POST',
                url: 'rebateresponse',
                dataType: 'json',
                data: {
                    'csrfmiddlewaretoken' : '{{ csrf_token }}',
                    'id_rebate':$("button.acc").attr("data-acc"),
                    'status':'0',

                },
                success: function(data) {

                        alert(data.message);


                },
                error: function(data, err) {
                    alert(err.message);
                }
            });

         }
        function getLeave(){

        }

</script>
{% endblock %}