{% extends 'globals/base.html' %}

{% load static %}

{% block title %}
IPR
{% endblock %}

{% block view_projects %}

{% block body %}
   
   
    <script>
      
        
        function openFile(event, index) {
            var file = files[index-1];
            var url = file.index
            console.log(url);
            window.location.href = "media/" + file.index;
        }



         // Assuming you have the files array defined in your JavaScript code
    // And you want to dynamically set the URL of the link
    // Loop through files array and set the href attribute of the link
    // var files = [{upload_file: {url: 'file1_url'}}, {upload_file: {url: 'file2_url'}}]; // Example files array
    window.onload = function() {
        var files = {{files|safe}}; // Assuming files is a list of dictionaries with upload_file key
        let link = document.getElementsByClassName('ui small blue equal-size-button button filelink');
        console.log("links length: "+link.length)
       for (var i = 0; i < files.length; i++) {
           link[i].href = files[i].upload_file.url;
           link[i].innerHTML="hello"; // Set the text of the link (optional
           // If you want to create separate links for each file, you can clone the link element
           // var newLink = link.cloneNode(true);
           // newLink.href = files[i].upload_file.url;
           // document.body.appendChild(newLink); // Append the new link to the body or another appropriate element
           
        } 
    }

    </script>



    <style>
        .equal-size-button {
            width: 100px; /* Adjust the width according to your preference */
        }
        .table .th{
            
        }
        .ui.selection.dropdown.small {
    font-size: 12px; /* Adjust the font size as needed */
    padding: 5px 10px; /* Adjust the padding as needed */
}

/* Optionally, you can adjust the font size and padding for the dropdown's default text */
.ui.selection.dropdown.small .default.text {
    font-size: 12px; /* Adjust the font size as needed */
    padding: 5px 10px; /* Adjust the padding as needed */
}
.ui.small.grey.equal-size-button.button:hover{
        background-color:black;
    }

    </style>
<div style="max-width:700px">
    <div class="ui pointing secondary menu" style="font-size:25px;">
        <label class="{% if mark5 != 1 and mark6 != 1 and mark7 != 1 %}active item{% else %} item {% endif %}">
            Inbox             
        </label>      
    </div>

    <table class="ui celled table  custom-table"">
        <thead>
            <tr style="background-color: grey; color: white; " >
                <th style="text-align: center;">S.No.</th>
                <th style="text-align: center;">From</th>
                <th style="text-align: center;">Context</th>
                {% comment %} <th style="text-align: center;">Attachments</th> {% endcomment %}
                <th style="text-align: center;">File</th>
                {% if global_var == "director" or global_var == "CSE HOD" or global_var == "rspc_admin" or global_var == "HOD (ECE)" or global_var == "HOD (ME)" or global_var == "HOD (NS)" or global_var == "dean_rspc" %}

                <th style="text-align: center;">Forward</th>
                {% endif %}
                {% if global_var == "director" or global_var == "CSE HOD"  or global_var == "HOD (ECE)" or global_var == "HOD (ME)" or global_var == "HOD (NS)" or global_var == "dean_rspc" %}
                <th style="text-align: center;">Approve</th>
                {% endif %}
                
            </tr>
        </thead>
        <tbody>
            {% comment %} {{files}} {% endcomment %}
            {% for data in files %}
            
            <tr>
                <td>{{forloop.counter}}</td>
                <td>{{data.uploader.user}}</td>
                <td>{{data.file_extra_JSON.message}}</td>
                {% comment %} <td><button></button></td> {% endcomment %}
                 {% comment %} <td><button class="ui small blue equal-size-button button" onclick="openFile(event,{{forloop.counter}})" >{{data.id}}</button> </td>  {% endcomment %}
            <td>
                {% if data.upload_file %}
               
                <a id="fileLink" class="ui small grey equal-size-button button" href="{{data.upload_file.url}}" ><i class="large download icon"></i></a>
                {% else %}
                <p>No file uploaded</p>
                {% endif %}
            </td>
            {% if global_var == "director" or global_var == "CSE HOD" or global_var == "rspc_admin" or global_var == "HOD (ECE)" or global_var == "HOD (ME)" or global_var == "HOD (NS)" or global_var == "dean_rspc" %}

                 <td>
                    
                    <form method="post" enctype="multipart/form-data" action="{% url 'research_procedures:forward_request'  %}" >
                        {% csrf_token %}
                        
                        <input name="file_id" value="{{data.id}}" type="hidden" >
                        <input name="message" value="{{data.file_extra_JSON.message}}" type="hidden" >
                        <div style="display:flex;flex-direction:row;">
                            <div class="eight wide field">

                                {% comment %} <label  for="receiver">select a role :</label> {% endcomment %}
                                <select id="receiver" name="receiver_designation" class="ui selection dropdown small">
                                    <option value="dean_rspc">RSPC Dean</option>
                                    <option value="rspc_admin">RSPC Admin</option>
                                    <option value="CSE HOD">HOD (CSE)</option>
                                    <option value="HOD (ME)">HOD (ME)</option>
                                    <option value="HOD (ECE)">HOD (ECE)</option>
                                    <option value="HOD (Design)">HOD (Design)</option>
                                    <option value="HOD (NS)">HOD (NS)</option>
                                    <option value="Director">Director</option>
                                </select>
                            </div>
                           
                            <button style="margin-left:5px; height:5vh;" class="ui small grey equal-size-button button"  type="submit"><i class="large share icon"></i></button>
                        </div>
                    </form>
                </td>
                {% endif %}

                {% if global_var == "director" or global_var == "CSE HOD" or  global_var == "HOD (ECE)" or global_var == "HOD (ME)" or global_var == "HOD (NS)" or global_var == "dean_rspc" %}
            <td>
                <form method="POST" enctype="multipart/form-data" action="{% url 'research_procedures:approve_request' data.id  %}">
                    {% csrf_token %}
                    <button style="margin-left:5px; height:5vh;" class="ui small grey equal-size-button button"  type="submit" >Approve</button>
                    {% comment %} <input name = "receiver" >{% endcomment %}
                </form>
            </td>
            {% endif %}

                 {% comment %} <td><a href="{{ files }}"   >{{ data.id }}</a></td> {% endcomment %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
{% endblock %}
</div>
{% endblock %}
